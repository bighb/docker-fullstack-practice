# 生产环境覆盖配置
# 使用方式: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  # PostgreSQL 生产配置
  postgres:
    restart: always # 自动重启
    deploy:
      resources:
        limits:
          memory: 512M

  # Redis 生产配置
  redis:
    restart: always
    command: redis-server --appendonly yes # 开启持久化
    deploy:
      resources:
        limits:
          memory: 256M

  # Node.js 后端生产配置
  backend:
    build:
      target: production # 使用生产阶段镜像
    restart: always
    volumes: [] # 清空开发环境的源码挂载
    command: [] # 清空开发命令，使用 Dockerfile 默认 CMD
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "1"

  # React 前端生产配置
  frontend:
    build:
      target: production # 使用生产阶段镜像
    restart: always
    volumes: [] # 清空开发环境的源码挂载
    command: [] # 清空开发命令
    deploy:
      resources:
        limits:
          memory: 256M

  # Nginx 生产配置
  nginx:
    restart: always
    deploy:
      resources:
        limits:
          memory: 128M
