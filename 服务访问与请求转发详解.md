# Docker å…¨æ ˆé¡¹ç›® - æœåŠ¡è®¿é—®ä¸è¯·æ±‚è½¬å‘è¯¦è§£

## ğŸ“š ç›®å½•

- [é¡¹ç›®æœåŠ¡è®¿é—®æ–¹å¼](#é¡¹ç›®æœåŠ¡è®¿é—®æ–¹å¼)
- [Nginx è¯·æ±‚è½¬å‘æœºåˆ¶](#nginx-è¯·æ±‚è½¬å‘æœºåˆ¶)
- [å‰åç«¯é€šä¿¡é…ç½®](#å‰åç«¯é€šä¿¡é…ç½®)
- [å®Œæ•´è¯·æ±‚é“¾è·¯ç¤ºä¾‹](#å®Œæ•´è¯·æ±‚é“¾è·¯ç¤ºä¾‹)
- [ç«¯å£æ˜ å°„å…³ç³»](#ç«¯å£æ˜ å°„å…³ç³»)
- [è®¿é—®ç­–ç•¥å»ºè®®](#è®¿é—®ç­–ç•¥å»ºè®®)
- [å…³é”®é…ç½®æ–‡ä»¶è¯´æ˜](#å…³é”®é…ç½®æ–‡ä»¶è¯´æ˜)

---

## ğŸŒ é¡¹ç›®æœåŠ¡è®¿é—®æ–¹å¼

### æ–¹å¼ä¸€ï¼šé€šè¿‡ Nginx ç»Ÿä¸€å…¥å£ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

**è®¿é—®åœ°å€ï¼š** `http://localhost:80` æˆ– `http://localhost`

**é…ç½®æ–‡ä»¶ä½ç½®ï¼š** `./nginx/nginx.conf`

**å·¥ä½œåŸç†ï¼š**
Nginx ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ ¹æ®è¯·æ±‚è·¯å¾„æ™ºèƒ½è½¬å‘åˆ°ç›¸åº”çš„æœåŠ¡ï¼š

- è®¿é—® `/` â†’ è½¬å‘åˆ°å‰ç«¯æœåŠ¡
- è®¿é—® `/api/*` â†’ è½¬å‘åˆ°åç«¯æœåŠ¡

**ä¼˜åŠ¿ï¼š**

- âœ… ç»Ÿä¸€å…¥å£ï¼Œä¾¿äºç®¡ç†
- âœ… å¯é…ç½®è´Ÿè½½å‡è¡¡
- âœ… æ”¯æŒ HTTPSã€ç¼“å­˜ã€é™æµç­‰åŠŸèƒ½
- âœ… ç”Ÿäº§ç¯å¢ƒæ ‡å‡†é…ç½®

---

### æ–¹å¼äºŒï¼šç›´æ¥è®¿é—®å‰ç«¯ï¼ˆæ¨èå¼€å‘ç¯å¢ƒï¼‰

**è®¿é—®åœ°å€ï¼š** `http://localhost:3000`

**é…ç½®æ–‡ä»¶ä½ç½®ï¼š** `docker-compose.yml` ç¬¬ 80 è¡Œ

```yaml
frontend:
  ports:
    - "3000:3000" # å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£
```

**å·¥ä½œåŸç†ï¼š**
ç›´æ¥è¿æ¥åˆ° React å¼€å‘æœåŠ¡å™¨ï¼Œç»•è¿‡ Nginx

**ä¼˜åŠ¿ï¼š**

- âœ… æ”¯æŒçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰
- âœ… å®æ—¶æŸ¥çœ‹ä»£ç ä¿®æ”¹æ•ˆæœ
- âœ… å¼€å‘è°ƒè¯•æ–¹ä¾¿

---

### æ–¹å¼ä¸‰ï¼šç›´æ¥è®¿é—®åç«¯ API

**è®¿é—®åœ°å€ï¼š** `http://localhost:5001/api/*`

**é…ç½®æ–‡ä»¶ä½ç½®ï¼š** `docker-compose.yml` ç¬¬ 57 è¡Œ

```yaml
backend:
  ports:
    - "5001:5001" # å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£
```

**å¸¸ç”¨ API ç«¯ç‚¹ï¼š**

- `GET http://localhost:5001/api/health` - å¥åº·æ£€æŸ¥
- `GET http://localhost:5001/api/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `POST http://localhost:5001/api/users` - åˆ›å»ºæ–°ç”¨æˆ·
- `GET http://localhost:5001/api/stats` - è·å–è®¿é—®ç»Ÿè®¡

**å·¥ä½œåŸç†ï¼š**
ç›´æ¥è¿æ¥åˆ° Express åç«¯æœåŠ¡ï¼Œé€‚åˆ API è°ƒè¯•

**ä¼˜åŠ¿ï¼š**

- âœ… API æ¥å£æµ‹è¯•æ–¹ä¾¿
- âœ… ä½¿ç”¨ Postman/curl ç­‰å·¥å…·ç›´æ¥è°ƒè¯•
- âœ… æŸ¥çœ‹æ¥å£å“åº”æ•°æ®

---

## ğŸ”„ Nginx è¯·æ±‚è½¬å‘æœºåˆ¶

### æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š`./nginx/nginx.conf`

```
è¯·æ±‚æµç¨‹å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµè§ˆå™¨  â”‚ â”€â”€â”€â†’ â”‚ Nginx:80 â”‚ â”€â”€â”€â†’ â”‚ è·¯ç”±åˆ¤æ–­     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â†“                                      â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Frontend    â”‚                      â”‚ Backend     â”‚
                  â”‚ (React)     â”‚                      â”‚ (Express)   â”‚
                  â”‚ Port: 3000  â”‚                      â”‚ Port: 5001  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### è½¬å‘è§„åˆ™è¯¦è§£

#### è§„åˆ™ 1ï¼šå‰ç«¯è¯·æ±‚è½¬å‘

**é…ç½®ä½ç½®ï¼š** `nginx/nginx.conf` ç¬¬ 29-42 è¡Œ

```nginx
# å‰ç«¯è·¯ç”±é…ç½®:å¤„ç†æ‰€æœ‰æ ¹è·¯å¾„è¯·æ±‚
location / {
    # å°†è¯·æ±‚ä»£ç†åˆ°å‰ç«¯æœåŠ¡
    proxy_pass http://frontend;
    # ä½¿ç”¨ HTTP 1.1 åè®®
    proxy_http_version 1.1;
    # è½¬å‘ WebSocket å‡çº§è¯·æ±‚å¤´ï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼‰
    proxy_set_header Upgrade $http_upgrade;
    # è½¬å‘ WebSocket è¿æ¥è¯·æ±‚å¤´
    proxy_set_header Connection 'upgrade';
    # è½¬å‘åŸå§‹ Host è¯·æ±‚å¤´
    proxy_set_header Host $host;
    # ä¸ç¼“å­˜éœ€è¦å‡çº§çš„è¯·æ±‚
    proxy_cache_bypass $http_upgrade;
}
```

**upstream å®šä¹‰ï¼š** `nginx/nginx.conf` ç¬¬ 15-18 è¡Œ

```nginx
# å®šä¹‰å‰ç«¯æœåŠ¡çš„ä¸Šæ¸¸æœåŠ¡å™¨ç»„
upstream frontend {
    # æŒ‡å®šå‰ç«¯æœåŠ¡çš„åœ°å€å’Œç«¯å£(Docker å®¹å™¨å:ç«¯å£)
    server frontend:3000;
}
```

**å®é™…è½¬å‘æµç¨‹ï¼š**

```
Step 1: ç”¨æˆ·è®¿é—®
  â†’ http://localhost/

Step 2: Nginx æ¥æ”¶
  â†’ ç›‘å¬ç«¯å£: 80
  â†’ åŒ¹é…è§„åˆ™: location /

Step 3: è½¬å‘è¯·æ±‚
  â†’ ç›®æ ‡åœ°å€: http://frontend:3000
  â†’ ç½‘ç»œ: app-networkï¼ˆDocker å†…éƒ¨ç½‘ç»œï¼‰

Step 4: React åº”ç”¨å“åº”
  â†’ è¿”å› HTML/JS/CSS èµ„æº
```

**å…³é”®è¯´æ˜ï¼š**

- `frontend` æ˜¯ Docker å®¹å™¨åç§°ï¼ˆå®šä¹‰åœ¨ `docker-compose.yml` ç¬¬ 71 è¡Œï¼‰
- å®¹å™¨é—´é€šè¿‡ `app-network` è‡ªå®šä¹‰ç½‘ç»œäº’è”ï¼ˆç¬¬ 113 è¡Œå®šä¹‰ï¼‰
- ç«¯å£ 3000 æ˜¯å®¹å™¨å†…éƒ¨ç«¯å£ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®ï¼ˆé™¤éç«¯å£æ˜ å°„ï¼‰
- Docker å†…ç½® DNS è‡ªåŠ¨è§£æå®¹å™¨ååˆ° IP åœ°å€

---

#### è§„åˆ™ 2ï¼šåç«¯ API è¯·æ±‚è½¬å‘

**é…ç½®ä½ç½®ï¼š** `nginx/nginx.conf` ç¬¬ 44-58 è¡Œ

```nginx
# åç«¯ API è·¯ç”±é…ç½®:å¤„ç†æ‰€æœ‰ /api å¼€å¤´çš„è¯·æ±‚
location /api {
    # å°†è¯·æ±‚ä»£ç†åˆ°åç«¯æœåŠ¡
    proxy_pass http://backend;
    # ä½¿ç”¨ HTTP 1.1 åè®®
    proxy_http_version 1.1;
    # è½¬å‘åŸå§‹ Host è¯·æ±‚å¤´
    proxy_set_header Host $host;
    # è½¬å‘å®¢æˆ·ç«¯çœŸå® IP åœ°å€
    proxy_set_header X-Real-IP $remote_addr;
    # è½¬å‘ä»£ç†é“¾è·¯ä¸­çš„æ‰€æœ‰ IP åœ°å€
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    # è½¬å‘åŸå§‹è¯·æ±‚åè®®(http æˆ– https)
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

**upstream å®šä¹‰ï¼š** `nginx/nginx.conf` ç¬¬ 9-12 è¡Œ

```nginx
# å®šä¹‰åç«¯æœåŠ¡çš„ä¸Šæ¸¸æœåŠ¡å™¨ç»„
upstream backend {
    # æŒ‡å®šåç«¯æœåŠ¡çš„åœ°å€å’Œç«¯å£(Docker å®¹å™¨å:ç«¯å£)
    server backend:5001;
}
```

**å®é™…è½¬å‘æµç¨‹ï¼š**

```
Step 1: ç”¨æˆ·/å‰ç«¯å‘èµ· API è¯·æ±‚
  â†’ http://localhost/api/users

Step 2: Nginx æ¥æ”¶
  â†’ ç›‘å¬ç«¯å£: 80
  â†’ åŒ¹é…è§„åˆ™: location /api

Step 3: è½¬å‘è¯·æ±‚
  â†’ ç›®æ ‡åœ°å€: http://backend:5001/api/users
  â†’ ç½‘ç»œ: app-networkï¼ˆDocker å†…éƒ¨ç½‘ç»œï¼‰
  â†’ æºå¸¦è¯·æ±‚å¤´: Host, X-Real-IP, X-Forwarded-For ç­‰

Step 4: Express åº”ç”¨å¤„ç†
  â†’ è·¯ç”±åŒ¹é…: app.get('/api/users', ...)
  â†’ æŸ¥è¯¢æ•°æ®åº“/ç¼“å­˜
  â†’ è¿”å› JSON æ•°æ®
```

**é‡è¦çš„è¯·æ±‚å¤´è¯´æ˜ï¼š**

- `X-Real-IP`ï¼šä¿ç•™å®¢æˆ·ç«¯çœŸå® IPï¼Œç”¨äºæ—¥å¿—è®°å½•å’Œè®¿é—®æ§åˆ¶
- `X-Forwarded-For`ï¼šè®°å½•ç»è¿‡çš„æ‰€æœ‰ä»£ç† IP é“¾è·¯
- `X-Forwarded-Proto`ï¼šæ ‡è¯†åŸå§‹è¯·æ±‚åè®®ï¼ˆhttp/httpsï¼‰ï¼Œä¾¿äºåç«¯å¤„ç†é‡å®šå‘

---

## ğŸ”— å‰åç«¯é€šä¿¡é…ç½®

### å‰ç«¯ API åœ°å€é…ç½®

**é…ç½®æ–‡ä»¶ï¼š** `./frontend/src/App.js` ç¬¬ 5 è¡Œ

```javascript
const API_URL = process.env.REACT_APP_API_URL || "http://localhost:5001";
```

**ç¯å¢ƒå˜é‡æ¥æºï¼š** `docker-compose.yml` ç¬¬ 77 è¡Œ

```yaml
frontend:
  environment:
    - REACT_APP_API_URL=${REACT_APP_API_URL}
```

**å®é™…å€¼å®šä¹‰ï¼š** `.env.example` ç¬¬ 31 è¡Œ

```bash
# å‰ç«¯é…ç½®
REACT_APP_API_URL=http://localhost:5001
```

**ä½¿ç”¨è¯´æ˜ï¼š**

1. å¤åˆ¶ `.env.example` ä¸º `.env`ï¼š

   ```bash
   cp .env.example .env
   ```

2. æ ¹æ®ç¯å¢ƒä¿®æ”¹ `REACT_APP_API_URL`ï¼š

   ```bash
   # å¼€å‘ç¯å¢ƒï¼ˆç›´æ¥è®¿é—®åç«¯ï¼‰
   REACT_APP_API_URL=http://localhost:5001

   # ç”Ÿäº§ç¯å¢ƒï¼ˆé€šè¿‡ Nginx ä»£ç†ï¼‰
   REACT_APP_API_URL=http://localhost

   # æˆ–ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
   REACT_APP_API_URL=
   ```

---

### å‰ç«¯ API è¯·æ±‚ç¤ºä¾‹

**é…ç½®æ–‡ä»¶ï¼š** `./frontend/src/App.js`

#### è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆç¬¬ 18-24 è¡Œï¼‰

```javascript
const fetchUsers = async () => {
  try {
    const response = await axios.get(`${API_URL}/api/users`);
    setUsers(response.data.data || []);
  } catch (error) {
    console.error("Error fetching users:", error);
  }
};

// å®é™…è¯·æ±‚åœ°å€ï¼šhttp://localhost:5001/api/users
```

#### åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆç¬¬ 36-48 è¡Œï¼‰

```javascript
const handleSubmit = async (e) => {
  e.preventDefault();
  setLoading(true);
  try {
    await axios.post(`${API_URL}/api/users`, formData);
    setFormData({ name: "", email: "" });
    fetchUsers();
  } catch (error) {
    console.error("Error creating user:", error);
    alert("Failed to create user");
  } finally {
    setLoading(false);
  }
};

// å®é™…è¯·æ±‚åœ°å€ï¼šhttp://localhost:5001/api/users
```

---

### åç«¯ API è·¯ç”±å®šä¹‰

**é…ç½®æ–‡ä»¶ï¼š** `./backend/src/index.js`

#### å¥åº·æ£€æŸ¥æ¥å£ï¼ˆç¬¬ 45-51 è¡Œï¼‰

```javascript
app.get("/api/health", (req, res) => {
  res.json({
    status: "ok",
    timestamp: new Date().toISOString(),
    environment: process.env.NODE_ENV,
  });
});
```

#### è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆç¬¬ 54-73 è¡Œï¼‰

```javascript
app.get("/api/users", async (req, res) => {
  try {
    // å°è¯•ä» Redis è·å–ç¼“å­˜
    const cached = await redisClient.get("users");
    if (cached) {
      console.log("ğŸ“¦ Returning cached data");
      return res.json({ source: "cache", data: JSON.parse(cached) });
    }

    // ä»æ•°æ®åº“æŸ¥è¯¢
    const result = await pool.query(
      "SELECT * FROM users ORDER BY created_at DESC"
    );

    // ç¼“å­˜ç»“æœï¼ˆ60ç§’ï¼‰
    await redisClient.setEx("users", 60, JSON.stringify(result.rows));

    res.json({ source: "database", data: result.rows });
  } catch (error) {
    console.error("Error:", error);
    res.status(500).json({ error: error.message });
  }
});
```

#### åˆ›å»ºç”¨æˆ·æ¥å£ï¼ˆç¬¬ 76-92 è¡Œï¼‰

```javascript
app.post("/api/users", async (req, res) => {
  try {
    const { name, email } = req.body;
    const result = await pool.query(
      "INSERT INTO users (name, email) VALUES ($1, $2) RETURNING *",
      [name, email]
    );

    // æ¸…é™¤ç¼“å­˜
    await redisClient.del("users");

    res.status(201).json(result.rows[0]);
  } catch (error) {
    console.error("Error:", error);
    res.status(500).json({ error: error.message });
  }
});
```

---

## ğŸ¯ å®Œæ•´è¯·æ±‚é“¾è·¯ç¤ºä¾‹

### åœºæ™¯ä¸€ï¼šé€šè¿‡ Nginx è®¿é—®å‰ç«¯ï¼Œç›´æ¥è¯·æ±‚åç«¯ APIï¼ˆå½“å‰é…ç½®ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨                                            â”‚
â”‚    â†’ http://localhost                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Nginx æ¥æ”¶è¯·æ±‚ï¼ˆç«¯å£ 80ï¼‰                                 â”‚
â”‚    â†’ åŒ¹é…è§„åˆ™: location /                                   â”‚
â”‚    â†’ è½¬å‘åˆ°: frontend:3000                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. React åº”ç”¨åŠ è½½                                            â”‚
â”‚    â†’ è¿”å› HTML/JS/CSS                                       â”‚
â”‚    â†’ æµè§ˆå™¨æ¸²æŸ“é¡µé¢                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. React å‘èµ· API è¯·æ±‚ï¼ˆApp.js useEffectï¼‰                  â”‚
â”‚    â†’ axios.get('http://localhost:5001/api/users')           â”‚
â”‚    â†’ æ³¨æ„ï¼šè¿™æ˜¯æµè§ˆå™¨ç›´æ¥å‘èµ·çš„è¯·æ±‚ï¼Œä¸ç»è¿‡ Nginx            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. åç«¯ Express å¤„ç†ï¼ˆindex.jsï¼‰                             â”‚
â”‚    â†’ è·¯ç”±åŒ¹é…: app.get('/api/users', ...)                   â”‚
â”‚    â†’ æ£€æŸ¥ Redis ç¼“å­˜                                        â”‚
â”‚    â†’ æŸ¥è¯¢ PostgreSQL æ•°æ®åº“                                 â”‚
â”‚    â†’ è¿”å› JSON æ•°æ®                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. React æ›´æ–°ç•Œé¢                                            â”‚
â”‚    â†’ setUsers(response.data.data)                           â”‚
â”‚    â†’ æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### åœºæ™¯äºŒï¼šå®Œå…¨é€šè¿‡ Nginx ä»£ç†ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

**éœ€è¦ä¿®æ”¹é…ç½®ï¼š**

1. ä¿®æ”¹ `.env` æ–‡ä»¶ï¼š

   ```bash
   REACT_APP_API_URL=
   # æˆ–
   REACT_APP_API_URL=http://localhost
   ```

2. å‰ç«¯è¯·æ±‚å˜ä¸ºï¼š
   ```javascript
   axios.get("/api/users"); // ç›¸å¯¹è·¯å¾„
   ```

**å®Œæ•´è¯·æ±‚é“¾è·¯ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨                                            â”‚
â”‚    â†’ http://localhost                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Nginx æ¥æ”¶è¯·æ±‚ï¼ˆç«¯å£ 80ï¼‰                                 â”‚
â”‚    â†’ åŒ¹é…è§„åˆ™: location /                                   â”‚
â”‚    â†’ è½¬å‘åˆ°: frontend:3000                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. React åº”ç”¨åŠ è½½                                            â”‚
â”‚    â†’ è¿”å› HTML/JS/CSS                                       â”‚
â”‚    â†’ æµè§ˆå™¨æ¸²æŸ“é¡µé¢                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. React å‘èµ· API è¯·æ±‚ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰                           â”‚
â”‚    â†’ axios.get('/api/users')                                â”‚
â”‚    â†’ å®é™…è¯·æ±‚: http://localhost/api/users                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Nginx æ¥æ”¶ API è¯·æ±‚ï¼ˆç«¯å£ 80ï¼‰                            â”‚
â”‚    â†’ åŒ¹é…è§„åˆ™: location /api                                â”‚
â”‚    â†’ è½¬å‘åˆ°: backend:5001/api/users                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. åç«¯ Express å¤„ç†                                         â”‚
â”‚    â†’ è·¯ç”±åŒ¹é…: app.get('/api/users', ...)                   â”‚
â”‚    â†’ æ£€æŸ¥ Redis ç¼“å­˜                                        â”‚
â”‚    â†’ æŸ¥è¯¢ PostgreSQL æ•°æ®åº“                                 â”‚
â”‚    â†’ è¿”å› JSON æ•°æ®                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Nginx è¿”å›å“åº”                                            â”‚
â”‚    â†’ é€ä¼ åç«¯å“åº”ç»™æµè§ˆå™¨                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. React æ›´æ–°ç•Œé¢                                            â”‚
â”‚    â†’ setUsers(response.data.data)                           â”‚
â”‚    â†’ æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ç«¯å£æ˜ å°„å…³ç³»

### ç«¯å£æ˜ å°„è¯¦ç»†è¡¨

| æœåŠ¡åç§°       | å®¹å™¨åç§°             | å®¹å™¨å†…ç«¯å£ | å®¿ä¸»æœºç«¯å£ | é…ç½®ä½ç½®                | å¤–éƒ¨è®¿é—®åœ°å€            | ç”¨é€”è¯´æ˜         |
| -------------- | -------------------- | ---------- | ---------- | ----------------------- | ----------------------- | ---------------- |
| **Nginx**      | `fullstack_nginx`    | 80         | 80         | `docker-compose.yml:96` | `http://localhost`      | åå‘ä»£ç†ç»Ÿä¸€å…¥å£ |
| **Frontend**   | `fullstack_frontend` | 3000       | 3000       | `docker-compose.yml:80` | `http://localhost:3000` | React å¼€å‘æœåŠ¡å™¨ |
| **Backend**    | `fullstack_backend`  | 5001       | 5001       | `docker-compose.yml:57` | `http://localhost:5001` | Express API æœåŠ¡ |
| **PostgreSQL** | `fullstack_postgres` | 5432       | 5432       | `docker-compose.yml:11` | `localhost:5432`        | æ•°æ®åº“æœåŠ¡       |
| **Redis**      | `fullstack_redis`    | 6379       | 6379       | `docker-compose.yml:28` | `localhost:6379`        | ç¼“å­˜æœåŠ¡         |

---

### å®¹å™¨é—´ç½‘ç»œé€šä¿¡

**ç½‘ç»œé…ç½®ï¼š** `docker-compose.yml` ç¬¬ 111-113 è¡Œ

```yaml
networks:
  app-network:
    driver: bridge # ä½¿ç”¨æ¡¥æ¥ç½‘ç»œé©±åŠ¨
```

**æ‰€æœ‰æœåŠ¡éƒ½è¿æ¥åˆ° `app-network`ï¼š**

```yaml
services:
  postgres:
    networks:
      - app-network

  redis:
    networks:
      - app-network

  backend:
    networks:
      - app-network

  frontend:
    networks:
      - app-network

  nginx:
    networks:
      - app-network
```

**å®¹å™¨é—´è®¿é—®è§„åˆ™ï¼š**

| æºæœåŠ¡  | ç›®æ ‡æœåŠ¡   | è®¿é—®åœ°å€        | è¯´æ˜                     |
| ------- | ---------- | --------------- | ------------------------ |
| Backend | PostgreSQL | `postgres:5432` | ä½¿ç”¨å®¹å™¨åä½œä¸ºä¸»æœºå     |
| Backend | Redis      | `redis:6379`    | Docker å†…ç½® DNS è‡ªåŠ¨è§£æ |
| Nginx   | Frontend   | `frontend:3000` | ä¸ä½¿ç”¨ localhost         |
| Nginx   | Backend    | `backend:5001`  | å®¹å™¨é—´é€šè¿‡å†…éƒ¨ç½‘ç»œé€šä¿¡   |

**åç«¯æ•°æ®åº“è¿æ¥é…ç½®ï¼š** `backend/src/index.js` ç¬¬ 14-20 è¡Œ

```javascript
const pool = new Pool({
  host: process.env.DB_HOST || "localhost", // å®¹å™¨ä¸­ä½¿ç”¨ 'postgres'
  port: process.env.DB_PORT || 5432,
  user: process.env.DB_USER || "postgres",
  password: process.env.DB_PASSWORD || "postgres123",
  database: process.env.DB_NAME || "myapp",
});
```

**ç¯å¢ƒå˜é‡é…ç½®ï¼š** `.env.example`

```bash
DB_HOST=postgres      # â† ä½¿ç”¨å®¹å™¨åï¼Œä¸æ˜¯ localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres123
DB_NAME=myapp

REDIS_HOST=redis      # â† ä½¿ç”¨å®¹å™¨åï¼Œä¸æ˜¯ localhost
REDIS_PORT=6379
```

---

## ğŸ’¡ è®¿é—®ç­–ç•¥å»ºè®®

### å¼€å‘ç¯å¢ƒï¼ˆå½“å‰é»˜è®¤é…ç½®ï¼‰

**æ¨èè®¿é—®æ–¹å¼ï¼š**

âœ… **è®¿é—®å‰ç«¯ç•Œé¢ï¼š** `http://localhost:3000`

- æ”¯æŒçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰
- ä»£ç ä¿®æ”¹å®æ—¶ç”Ÿæ•ˆ
- ä¾¿äºå‰ç«¯å¼€å‘è°ƒè¯•

âœ… **æµ‹è¯•åç«¯ APIï¼š** `http://localhost:5001/api/*`

- ä½¿ç”¨ Postmanã€curlã€æµè§ˆå™¨ç›´æ¥æµ‹è¯•
- æŸ¥çœ‹æ¥å£å“åº”æ•°æ®
- ä¾¿äºåç«¯æ¥å£è°ƒè¯•

âš ï¸ **Nginx è®¿é—®ï¼š** `http://localhost` ï¼ˆå¯é€‰ï¼‰

- ä¸»è¦ç”¨äºæµ‹è¯•åå‘ä»£ç†é…ç½®
- æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒè®¿é—®æ–¹å¼

**é…ç½®ç‰¹ç‚¹ï¼š**

```bash
# .env é…ç½®
REACT_APP_API_URL=http://localhost:5001  # å‰ç«¯ç›´è¿åç«¯
NODE_ENV=development
```

**docker-compose.yml ç‰¹ç‚¹ï¼š**

```yaml
backend:
  volumes:
    - ./backend/src:/app/src # æŒ‚è½½æºç ï¼Œæ”¯æŒçƒ­æ›´æ–°
  command: npm run dev # ä½¿ç”¨å¼€å‘å‘½ä»¤ï¼ˆnodemonï¼‰

frontend:
  volumes:
    - ./frontend/src:/app/src # æŒ‚è½½æºç ï¼Œæ”¯æŒçƒ­æ›´æ–°
  command: npm start # React å¼€å‘æœåŠ¡å™¨
```

---

### ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®®

**æ¨èè®¿é—®æ–¹å¼ï¼š**

âœ… **ç»Ÿä¸€é€šè¿‡ Nginxï¼š** `http://localhost`ï¼ˆæˆ–åŸŸåï¼‰

- æ‰€æœ‰è¯·æ±‚ç»è¿‡åå‘ä»£ç†
- ç»Ÿä¸€çš„å®‰å…¨ç­–ç•¥å’Œè®¿é—®æ§åˆ¶
- ä¾¿äºè´Ÿè½½å‡è¡¡å’Œç¼“å­˜é…ç½®

ğŸ”’ **å…³é—­ç›´æ¥ç«¯å£è®¿é—®**

ä¿®æ”¹ `docker-compose.prod.yml`ï¼š

```yaml
services:
  # å‰ç«¯ä¸æš´éœ²ç«¯å£
  frontend:
    ports: [] # æ¸…ç©ºç«¯å£æ˜ å°„

  # åç«¯ä¸æš´éœ²ç«¯å£
  backend:
    ports: [] # æ¸…ç©ºç«¯å£æ˜ å°„

  # åªæœ‰ Nginx å¯¹å¤–
  nginx:
    ports:
      - "80:80"
      - "443:443" # å¦‚æœé…ç½®äº† HTTPS
```

**ä¿®æ”¹å‰ç«¯ API é…ç½®ï¼š**

æ–¹å¼ 1ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆæ¨èï¼‰

```bash
# .env.production
REACT_APP_API_URL=
```

```javascript
// frontend/src/App.js
const API_URL = process.env.REACT_APP_API_URL || "";

// è¯·æ±‚å˜ä¸ºï¼š
axios.get("/api/users"); // ç›¸å¯¹è·¯å¾„ï¼Œè‡ªåŠ¨ä½¿ç”¨å½“å‰åŸŸå
```

æ–¹å¼ 2ï¼šä½¿ç”¨å®Œæ•´åŸŸå

```bash
# .env.production
REACT_APP_API_URL=https://yourdomain.com
```

**å¯åŠ¨ç”Ÿäº§ç¯å¢ƒï¼š**

```bash
# ä½¿ç”¨ç”Ÿäº§é…ç½®è¦†ç›–
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# æˆ–ä½¿ç”¨ Makefile
make prod-up
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®ç‰¹ç‚¹ï¼š** `docker-compose.prod.yml`

```yaml
services:
  backend:
    build:
      target: production # ä½¿ç”¨ç”Ÿäº§æ„å»ºé˜¶æ®µ
    volumes: [] # ä¸æŒ‚è½½æºç 
    command: [] # ä½¿ç”¨ Dockerfile çš„ CMD
    restart: always # è‡ªåŠ¨é‡å¯
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "1"

  frontend:
    build:
      target: production # ä½¿ç”¨ Nginx æ‰˜ç®¡é™æ€æ–‡ä»¶
    volumes: []
    restart: always
```

---

### å®‰å…¨åŠ å›ºå»ºè®®

#### 1. æ•°æ®åº“å’Œç¼“å­˜ç«¯å£ä¿æŠ¤

**é—®é¢˜ï¼š** å½“å‰é…ç½®æš´éœ²äº†æ•°æ®åº“ç«¯å£

```yaml
postgres:
  ports:
    - "5432:5432" # âš ï¸ ç”Ÿäº§ç¯å¢ƒä¸åº”æš´éœ²

redis:
  ports:
    - "6379:6379" # âš ï¸ ç”Ÿäº§ç¯å¢ƒä¸åº”æš´éœ²
```

**è§£å†³æ–¹æ¡ˆï¼š** ç§»é™¤ç«¯å£æ˜ å°„

```yaml
postgres:
  # ports: []  # ä¸å¯¹å¤–æš´éœ²ï¼Œåªå…è®¸å®¹å™¨é—´è®¿é—®
  networks:
    - app-network

redis:
  # ports: []
  networks:
    - app-network
```

å®¹å™¨å†…çš„æœåŠ¡ä»å¯é€šè¿‡ `postgres:5432` å’Œ `redis:6379` è®¿é—®ã€‚

---

#### 2. é…ç½® HTTPS

**ä¿®æ”¹ Nginx é…ç½®ï¼š** `nginx/nginx.conf`

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    # HTTP é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;

    # SSL å®‰å…¨é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # å…¶ä»–é…ç½®ä¿æŒä¸å˜...
}
```

**æŒ‚è½½ SSL è¯ä¹¦ï¼š** `docker-compose.yml`

```yaml
nginx:
  volumes:
    - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    - ./nginx/ssl:/etc/nginx/ssl:ro # æŒ‚è½½ SSL è¯ä¹¦
  ports:
    - "80:80"
    - "443:443" # å¼€æ”¾ HTTPS ç«¯å£
```

---

#### 3. ç¯å¢ƒå˜é‡å®‰å…¨

**ä¸è¦æäº¤ `.env` æ–‡ä»¶åˆ° Gitï¼š**

```bash
# .gitignore
.env
.env.local
.env.production
```

**ä½¿ç”¨å¯†é’¥ç®¡ç†å·¥å…·ï¼š**

- Docker Secrets
- Kubernetes Secrets
- AWS Secrets Manager
- HashiCorp Vault

---

## ğŸ“ å…³é”®é…ç½®æ–‡ä»¶è¯´æ˜

### 1. `docker-compose.yml`

**ä½œç”¨ï¼š** å®šä¹‰æ‰€æœ‰æœåŠ¡ã€ç«¯å£æ˜ å°„ã€ç½‘ç»œå’Œæ•°æ®å·

**å…³é”®é…ç½®æ®µï¼š**

| è¡Œå·    | é…ç½®å†…å®¹        | è¯´æ˜                                     |
| ------- | --------------- | ---------------------------------------- |
| 3-21    | PostgreSQL æœåŠ¡ | æ•°æ®åº“é…ç½®ï¼ŒåŒ…æ‹¬ç¯å¢ƒå˜é‡ã€ç«¯å£ã€å¥åº·æ£€æŸ¥ |
| 24-37   | Redis æœåŠ¡      | ç¼“å­˜æœåŠ¡é…ç½®                             |
| 40-67   | Backend æœåŠ¡    | Node.js åç«¯ï¼Œä¾èµ–æ•°æ®åº“å’Œç¼“å­˜           |
| 70-87   | Frontend æœåŠ¡   | React å‰ç«¯ï¼Œä¾èµ–åç«¯                     |
| 90-101  | Nginx æœåŠ¡      | åå‘ä»£ç†ï¼Œä¾èµ–å‰åç«¯                     |
| 103-107 | æ•°æ®å·å®šä¹‰      | æŒä¹…åŒ–æ•°æ®åº“å’Œç¼“å­˜æ•°æ®                   |
| 109-113 | ç½‘ç»œå®šä¹‰        | è‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œï¼Œå®¹å™¨é—´é€šä¿¡               |

---

### 2. `docker-compose.prod.yml`

**ä½œç”¨ï¼š** ç”Ÿäº§ç¯å¢ƒè¦†ç›–é…ç½®

**ä½¿ç”¨æ–¹æ³•ï¼š**

```bash
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

**ä¸»è¦å·®å¼‚ï¼š**

- ä½¿ç”¨ç”Ÿäº§æ„å»ºç›®æ ‡ï¼ˆ`target: production`ï¼‰
- ç§»é™¤æºç æŒ‚è½½ï¼ˆä¸éœ€è¦çƒ­æ›´æ–°ï¼‰
- é…ç½®èµ„æºé™åˆ¶ï¼ˆCPUã€å†…å­˜ï¼‰
- å¯ç”¨è‡ªåŠ¨é‡å¯ï¼ˆ`restart: always`ï¼‰

---

### 3. `nginx/nginx.conf`

**ä½œç”¨ï¼š** Nginx åå‘ä»£ç†æ ¸å¿ƒé…ç½®

**é…ç½®ç»“æ„ï¼š**

```nginx
events { }              # è¿æ¥é…ç½®ï¼ˆç¬¬2-4è¡Œï¼‰

http {
  upstream backend { }  # åç«¯ä¸Šæ¸¸ï¼ˆç¬¬9-12è¡Œï¼‰
  upstream frontend { } # å‰ç«¯ä¸Šæ¸¸ï¼ˆç¬¬15-18è¡Œï¼‰

  server {
    listen 80;          # ç›‘å¬ç«¯å£ï¼ˆç¬¬23è¡Œï¼‰

    location / { }      # å‰ç«¯è·¯ç”±ï¼ˆç¬¬28-41è¡Œï¼‰
    location /api { }   # APIè·¯ç”±ï¼ˆç¬¬44-58è¡Œï¼‰
  }
}
```

**å…³é”®æŒ‡ä»¤è¯´æ˜ï¼š**

- `upstream`ï¼šå®šä¹‰ä¸Šæ¸¸æœåŠ¡å™¨ç»„
- `proxy_pass`ï¼šè½¬å‘è¯·æ±‚åˆ°ä¸Šæ¸¸
- `proxy_set_header`ï¼šè®¾ç½®è½¬å‘çš„è¯·æ±‚å¤´
- `proxy_http_version`ï¼šä½¿ç”¨ HTTP/1.1 åè®®

---

### 4. `.env` / `.env.example`

**ä½œç”¨ï¼š** ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿

**ä½¿ç”¨æ­¥éª¤ï¼š**

```bash
# 1. å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env

# 2. ä¿®æ”¹é…ç½®
vim .env

# 3. å¯åŠ¨æœåŠ¡
docker-compose up -d
```

**é…ç½®åˆ†ç±»ï¼š**

```bash
# æ•°æ®åº“é…ç½®ï¼ˆè¡Œ8-14ï¼‰
DB_HOST=postgres           # å®¹å™¨åï¼Œä¸æ˜¯ localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres123    # âš ï¸ ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¼ºå¯†ç 
DB_NAME=myapp

# Redis é…ç½®ï¼ˆè¡Œ18-20ï¼‰
REDIS_HOST=redis
REDIS_PORT=6379

# åç«¯é…ç½®ï¼ˆè¡Œ24-26ï¼‰
NODE_ENV=development       # development | production
PORT=5001

# å‰ç«¯é…ç½®ï¼ˆè¡Œ30-31ï¼‰
REACT_APP_API_URL=http://localhost:5001  # å¼€å‘ç¯å¢ƒ
# REACT_APP_API_URL=                     # ç”Ÿäº§ç¯å¢ƒï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
```

---

### 5. `backend/src/index.js`

**ä½œç”¨ï¼š** Express åç«¯æœåŠ¡ä¸»æ–‡ä»¶

**å…³é”®é…ç½®æ®µï¼š**

| è¡Œå·   | å†…å®¹                | è¯´æ˜                   |
| ------ | ------------------- | ---------------------- |
| 7      | `const PORT = 5001` | ç›‘å¬ç«¯å£               |
| 10     | `app.use(cors())`   | å¯ç”¨è·¨åŸŸï¼ˆå¼€å‘ç¯å¢ƒï¼‰   |
| 14-20  | PostgreSQL è¿æ¥     | ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®       |
| 23-28  | Redis è¿æ¥          | ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®       |
| 45-51  | `/api/health`       | å¥åº·æ£€æŸ¥æ¥å£           |
| 54-73  | `/api/users` (GET)  | è·å–ç”¨æˆ·åˆ—è¡¨ï¼Œä½¿ç”¨ç¼“å­˜ |
| 76-92  | `/api/users` (POST) | åˆ›å»ºç”¨æˆ·ï¼Œæ¸…é™¤ç¼“å­˜     |
| 95-102 | `/api/stats`        | è®¿é—®ç»Ÿè®¡               |

**ç”Ÿäº§ç¯å¢ƒ CORS é…ç½®å»ºè®®ï¼š**

```javascript
// å¼€å‘ç¯å¢ƒ
app.use(cors());

// ç”Ÿäº§ç¯å¢ƒ
app.use(
  cors({
    origin: "https://yourdomain.com", // åªå…è®¸ç‰¹å®šåŸŸå
    credentials: true,
  })
);
```

---

### 6. `frontend/src/App.js`

**ä½œç”¨ï¼š** React å‰ç«¯ä¸»ç»„ä»¶

**å…³é”®é…ç½®ï¼š**

| è¡Œå·  | å†…å®¹             | è¯´æ˜                         |
| ----- | ---------------- | ---------------------------- |
| 5     | `const API_URL`  | API åŸºç¡€åœ°å€ï¼Œä»ç¯å¢ƒå˜é‡è¯»å– |
| 18-24 | `fetchUsers()`   | è·å–ç”¨æˆ·åˆ—è¡¨ API è°ƒç”¨        |
| 26-33 | `fetchStats()`   | è·å–ç»Ÿè®¡æ•°æ®                 |
| 36-48 | `handleSubmit()` | åˆ›å»ºç”¨æˆ·è¡¨å•æäº¤             |

**API è°ƒç”¨æ–¹å¼ï¼š**

```javascript
// ä½¿ç”¨ axios å‘èµ·è¯·æ±‚
await axios.get(`${API_URL}/api/users`);
await axios.post(`${API_URL}/api/users`, formData);

// å®é™…è¯·æ±‚åœ°å€å–å†³äº REACT_APP_API_URL ç¯å¢ƒå˜é‡ï¼š
// å¼€å‘ï¼šhttp://localhost:5001/api/users
// ç”Ÿäº§ï¼šhttp://yourdomain.com/api/users æˆ– /api/usersï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
```

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

### æµ‹è¯•å„ä¸ªæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ

```bash
# 1. æµ‹è¯• Nginxï¼ˆåº”è¿”å› React åº”ç”¨ï¼‰
curl http://localhost

# 2. æµ‹è¯•å‰ç«¯ç›´æ¥è®¿é—®ï¼ˆåº”è¿”å› HTMLï¼‰
curl http://localhost:3000

# 3. æµ‹è¯•åç«¯å¥åº·æ£€æŸ¥
curl http://localhost:5001/api/health

# 4. æµ‹è¯•åç«¯ API - è·å–ç”¨æˆ·åˆ—è¡¨
curl http://localhost:5001/api/users

# 5. æµ‹è¯•åç«¯ API - åˆ›å»ºç”¨æˆ·
curl -X POST http://localhost:5001/api/users \
  -H "Content-Type: application/json" \
  -d '{"name":"æµ‹è¯•ç”¨æˆ·","email":"test@example.com"}'

# 6. æµ‹è¯•è®¿é—®ç»Ÿè®¡
curl http://localhost:5001/api/stats

# 7. æµ‹è¯• PostgreSQL è¿æ¥
docker exec fullstack_postgres psql -U postgres -d myapp -c "SELECT * FROM users;"

# 8. æµ‹è¯• Redis è¿æ¥
docker exec fullstack_redis redis-cli KEYS '*'

# 9. æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose ps

# 10. æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs backend

# 11. æŸ¥çœ‹ Nginx æ—¥å¿—
docker-compose logs nginx
```

---

### æµ‹è¯• Nginx åå‘ä»£ç†

**å¦‚æœé…ç½®ä¸ºé€šè¿‡ Nginx ä»£ç† APIï¼ˆéœ€ä¿®æ”¹å‰ç«¯é…ç½®ï¼‰ï¼š**

```bash
# 1. ä¿®æ”¹ .env
REACT_APP_API_URL=http://localhost

# 2. é‡å¯å‰ç«¯æœåŠ¡
docker-compose restart frontend

# 3. æµ‹è¯•é€šè¿‡ Nginx è®¿é—® APIï¼ˆåº”è¯¥å·¥ä½œï¼‰
curl http://localhost/api/health
curl http://localhost/api/users

# 4. æŸ¥çœ‹ Nginx è®¿é—®æ—¥å¿—
docker-compose logs nginx | grep "/api"
```

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šæ— æ³•è®¿é—®æœåŠ¡

**ç—‡çŠ¶ï¼š** æµè§ˆå™¨æ˜¾ç¤º "æ— æ³•è¿æ¥"

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ
docker-compose ps

# 2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
lsof -i :80
lsof -i :3000
lsof -i :5001

# 3. æ£€æŸ¥æœåŠ¡æ—¥å¿—
docker-compose logs nginx
docker-compose logs frontend
docker-compose logs backend

# 4. æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network inspect docker-fullstack-practice_app-network
```

---

### é—®é¢˜ 2ï¼šå‰ç«¯æ— æ³•è¯·æ±‚åç«¯ API

**ç—‡çŠ¶ï¼š** æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º CORS é”™è¯¯æˆ–è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://localhost:5001/api/health

# 2. æ£€æŸ¥ .env é…ç½®
cat .env | grep REACT_APP_API_URL

# 3. æ£€æŸ¥å‰ç«¯ç¯å¢ƒå˜é‡
docker exec fullstack_frontend env | grep REACT_APP_API_URL

# 4. æ£€æŸ¥ CORS é…ç½®
docker-compose logs backend | grep CORS

# 5. é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose down
docker-compose up --build -d
```

---

### é—®é¢˜ 3ï¼šNginx 502 Bad Gateway

**ç—‡çŠ¶ï¼š** è®¿é—® `http://localhost` æ˜¾ç¤º 502 é”™è¯¯

**åŸå› ï¼š** Nginx æ— æ³•è¿æ¥åˆ°ä¸Šæ¸¸æœåŠ¡

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥åç«¯/å‰ç«¯æ˜¯å¦è¿è¡Œ
docker-compose ps

# 2. æ£€æŸ¥å®¹å™¨é—´ç½‘ç»œè¿é€šæ€§
docker exec fullstack_nginx ping frontend
docker exec fullstack_nginx ping backend

# 3. æ£€æŸ¥ Nginx é…ç½®è¯­æ³•
docker exec fullstack_nginx nginx -t

# 4. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
docker-compose logs nginx | grep error

# 5. æ£€æŸ¥ä¸Šæ¸¸æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost:3000  # å‰ç«¯
curl http://localhost:5001/api/health  # åç«¯
```

---

### é—®é¢˜ 4ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š** åç«¯æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
docker-compose ps postgres

# 2. æ£€æŸ¥æ•°æ®åº“å¥åº·çŠ¶æ€
docker exec fullstack_postgres pg_isready -U postgres

# 3. æµ‹è¯•æ•°æ®åº“è¿æ¥
docker exec fullstack_postgres psql -U postgres -d myapp -c "SELECT 1;"

# 4. æ£€æŸ¥ç¯å¢ƒå˜é‡
docker exec fullstack_backend env | grep DB_

# 5. æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs postgres

# 6. æ‰‹åŠ¨è¿æ¥æµ‹è¯•
docker exec -it fullstack_backend node -e "
const { Pool } = require('pg');
const pool = new Pool({
  host: 'postgres',
  port: 5432,
  user: 'postgres',
  password: 'postgres123',
  database: 'myapp'
});
pool.query('SELECT NOW()', (err, res) => {
  console.log(err || res.rows);
  pool.end();
});
"
```

---

## ğŸ“š æ‰©å±•é˜…è¯»

### Docker ç›¸å…³

- [Docker Compose å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/compose/)
- [Docker ç½‘ç»œæ¨¡å¼è¯¦è§£](https://docs.docker.com/network/)
- [Docker æ•°æ®å·ç®¡ç†](https://docs.docker.com/storage/volumes/)

### Nginx ç›¸å…³

- [Nginx åå‘ä»£ç†é…ç½®](http://nginx.org/en/docs/http/ngx_http_proxy_module.html)
- [Nginx è´Ÿè½½å‡è¡¡](http://nginx.org/en/docs/http/load_balancing.html)
- [Nginx æ€§èƒ½ä¼˜åŒ–](https://www.nginx.com/blog/tuning-nginx/)

### å‰åç«¯åˆ†ç¦»æ¶æ„

- [RESTful API è®¾è®¡è§„èŒƒ](https://restfulapi.net/)
- [è·¨åŸŸèµ„æºå…±äº« (CORS)](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS)
- [React ç¯å¢ƒå˜é‡é…ç½®](https://create-react-app.dev/docs/adding-custom-environment-variables/)

---

## âœ… æ€»ç»“

### å…³é”®è¦ç‚¹

1. **ä¸‰ç§è®¿é—®æ–¹å¼ï¼š**

   - Nginx ç»Ÿä¸€å…¥å£ï¼ˆç”Ÿäº§æ¨èï¼‰
   - ç›´æ¥è®¿é—®å‰ç«¯ï¼ˆå¼€å‘æ¨èï¼‰
   - ç›´æ¥è®¿é—®åç«¯ APIï¼ˆè°ƒè¯•æ¨èï¼‰

2. **Nginx è½¬å‘è§„åˆ™ï¼š**

   - `/` â†’ `frontend:3000`ï¼ˆå‰ç«¯ï¼‰
   - `/api` â†’ `backend:5001`ï¼ˆåç«¯ APIï¼‰

3. **å®¹å™¨é—´é€šä¿¡ï¼š**

   - ä½¿ç”¨å®¹å™¨åä½œä¸ºä¸»æœºå
   - é€šè¿‡ `app-network` è‡ªå®šä¹‰ç½‘ç»œ
   - Docker å†…ç½® DNS è‡ªåŠ¨è§£æ

4. **ç¯å¢ƒé…ç½®ï¼š**

   - å¼€å‘ç¯å¢ƒï¼šç›´æ¥æš´éœ²ç«¯å£ï¼Œæ”¯æŒçƒ­æ›´æ–°
   - ç”Ÿäº§ç¯å¢ƒï¼šåªæš´éœ² Nginxï¼Œä½¿ç”¨ç”Ÿäº§æ„å»º

5. **å®‰å…¨å»ºè®®ï¼š**
   - ä¸æš´éœ²æ•°æ®åº“å’Œç¼“å­˜ç«¯å£
   - é…ç½® HTTPS
   - ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
   - é™åˆ¶ CORS ç™½åå•

### ä¸‹ä¸€æ­¥å­¦ä¹ 

- [ ] é…ç½® HTTPS å’Œ SSL è¯ä¹¦
- [ ] å®ç° Nginx è´Ÿè½½å‡è¡¡
- [ ] æ·»åŠ æ—¥å¿—èšåˆå’Œç›‘æ§
- [ ] é…ç½® CI/CD è‡ªåŠ¨éƒ¨ç½²
- [ ] å­¦ä¹  Kubernetes ç¼–æ’

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**æœ€åæ›´æ–°ï¼š** 2025-11-24  
**ä½œè€…ï¼š** GitHub Copilot CLI
